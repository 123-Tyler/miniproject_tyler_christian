
#install.packages("tidyverse")
#library(tidyverse)

# Merging data ------------------------------------------------------------

# Import the three forms data from the Epicollect Download
transect_points <- read.csv('MSc Ecology, Conservation & Evolution/Tree survey week 1/transect_data.csv', stringsAsFactors=FALSE)

#contains data for ground cover and light availability
tree_quarters <- read.csv("MSc Ecology, Conservation & Evolution/Tree survey week 1/form-2__tree-quarters.csv", stringsAsFactors=FALSE) #contains data

#for tree species and distance to sample point in each quarter
stem_data <- read.csv("MSc Ecology, Conservation & Evolution/Tree survey week 1/form-3__stem-data.csv", stringsAsFactors=FALSE) #contains girth and

#data to calculate stem height

# join transect point data to the rows in the tree quarter data

# Table 2: Tree community and density estimation from your practical
tree_level_data <- merge(tree_quarters, transect_points,
                         by.x='ec5_parent_uuid', by.y='ec5_uuid',
                         suffixes=c('.tree','.transect'))

# Save table in csv format
write.csv(tree_level_data,"tree_level_data.csv") # all data

# Table 3: Above ground biomass estimation

# First merge the tree quarter data on to the stem data
compiled_data <- merge(stem_data, tree_quarters,
                       by.x='ec5_parent_uuid', by.y='ec5_uuid',
                       suffixes=c('.stem','.tree'))

# Take that merged data and add in the transect point data, by matching
compiled_data <- merge(compiled_data, transect_points,
                       by.x='ec5_parent_uuid.tree', by.y='ec5_uuid')

# Save table in csv format
write.csv(compiled_data,"compiled_data.csv")
    
# all data

# filter for group 1

compiled_data <- 
  filter(compiled_data, Group == 1)

# Density -----------------------------------------------------------------

# absolute density

compiled_data$Stem_distance <-
  as.factor(compiled_data$Stem_distance)

summary(compiled_data$Stem_distance)

absolute_density <- function(distance, total_trees){
  r <-  sum(compiled_data$Stem_distance)/total_trees
  x <- 1/(r^2)
  print(x)
}

absolute_density(10, 4)

absolute_k <- 
  k <-  function(x, tree){
    sum(compiled_data[compiled_data$Tree_Sp==tree]/40)*x
    print(k)
  }

absolute_k(0.01, "Acer pseudoplatanus (sycamore)")

sum(compiled_data$Tree_Sp=="Fagus sylvatica (beech)")


# remove na, reduce to our data


